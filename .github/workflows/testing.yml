name: Automatic Testing

on:
    push:
      branches: ["main"]
    pull_request:
        branches: ["main"]
    workflow_dispatch:
        inputs:
            logLevel:
                description: "Log level"
                required: true
                default: "warning"
                type: choice
                options:
                - info
                - warning
                - debug

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
        contents: read
        packages: write

    steps:
      - uses: actions/checkout@v4
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '8'
          distribution: 'zulu'
          cache: 'maven'

      - name: Install Maven
        run: sudo apt-get update; sudo apt-get install maven -y

      - name: Clear Maven cache
        run: mvn dependency:purge-local-repository -DactTransitively=false -DreResolve=false

      - name: Build with Maven
        run: mvn clean validate compile test test-compile --file pom.xml